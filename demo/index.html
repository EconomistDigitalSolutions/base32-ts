<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@niyari/base32-ts</title>
    <style>
        textarea {
            min-width: 25%;
            min-height: 4.5em;
            width: 40%;
        }

        .error-text {
            color: red;
        }
    </style>
</head>

<body>
    <div>
        @niyari/base32-ts / <a href="https://github.com/niyari/base32-ts">Repository</a> / <a
            href="https://niyari.github.io/base32-ts/">README</a>
    </div>
    <section>
        <div>
            <div>
                Input value <span id="in_error" class="error-text"></span>
            </div>
            <textarea type="text" style="width: 50%" placeholder="input" id="input" rows="4"></textarea>
        </div>
    </section>
    <hr>
    <section>
        <div>
            <div>
                Base32
            </div>
            <textarea type="text" placeholder="Encode" id="base32_e" rows="4"></textarea>
            <textarea type="text" placeholder="Decode" id="base32_d" rows="4"></textarea>
        </div>
    </section>

    <section>
        <div>
            <div>
                Base32_HEX
            </div>
            <textarea type="text" placeholder="Encode" id="hex_e" rows="4"></textarea>
            <textarea type="text" placeholder="Decode" id="hex_d" rows="4"></textarea>
        </div>
    </section>

    <section>
        <div>
            <div>
                Clockwork Base32
            </div>
            <textarea type="text" placeholder="Encode" id="cw_e" rows="4"></textarea>
            <textarea type="text" placeholder="Decode" id="cw_d" rows="4"></textarea>
        </div>
    </section>
    <hr>
    <section>
        <div>
            <div>
                Crockford
            </div>
            <div>
                <input id="cf_checksum" type="checkbox" value="1"><label for="cf_checksum">Checksum</label>
                <input id="cf_split" type="checkbox" value="1"><label for="cf_split">split(2)</label>
            </div>
            <div>
                <span id="cf_error" class="error-text"></span> Input value (Positive integer value. And the maximum
                number that the browser supports.)
            </div>
            <input type="tel" style="width: 50%" placeholder="number" id="input_cf">
        </div>
    </section>
    <hr>
    <section>
        <div>
            <textarea type="text" placeholder="Encode" id="cf_e" rows="4"></textarea>
            <textarea type="text" placeholder="Decode" id="cf_d" rows="4"></textarea>
        </div>
    </section>

    <script>
        const in_error = document.getElementById("in_error");
        try {
            let testbigint = BigInt(1);
        } catch (error) {
            in_error.textContent = 'ERROR: Require : ECMAScript 2020+';
        }

    </script>

    <script type="module">
        import { Base32 } from "../dist/base32.js";
        window.Base32 = Base32;

        window.addEventListener("DOMContentLoaded", () => {
            const input = document.getElementById("input");
            const input_cf = document.getElementById("input_cf");
            const cf_error = document.getElementById("cf_error");
            const base32 = new Base32();
            const base32_hex = new Base32({ variant: 'hex' });
            const base32_clockwork = new Base32({ variant: 'clockwork' });
            const base32_crockford = new Base32({ variant: 'crockford' });
            const base32_e = document.getElementById("base32_e");
            const base32_d = document.getElementById("base32_d");
            const hex_e = document.getElementById("hex_e");
            const hex_d = document.getElementById("hex_d");
            const cw_e = document.getElementById("cw_e");
            const cw_d = document.getElementById("cw_d");

            const cf_checksum = document.getElementById("cf_checksum");
            const cf_split = document.getElementById("cf_split");
            const cf_e = document.getElementById("cf_e");
            const cf_d = document.getElementById("cf_d");


            input.addEventListener('input', (e) => {
                cf_error.textContent = '';
                base32_e.value = base32.encode(input.value);
                base32_d.value = base32.decode(base32_e.value);

                hex_e.value = base32_hex.encode(input.value);
                hex_d.value = base32_hex.decode(hex_e.value);

                cw_e.value = base32_clockwork.encode(input.value);
                cw_d.value = base32_clockwork.decode(cw_e.value);
            });
            // crockford
            cf_checksum.addEventListener('change', (e) => {
                // 本来はこのような使い方をしない。
                if (base32_crockford._mode.checksum) {
                    base32_crockford._mode.checksum = false;
                } else {
                    base32_crockford._mode.checksum = true;
                }
            });
            cf_split.addEventListener('change', (e) => {
                // 本来はこのような使い方をしない。
                if (base32_crockford._mode.split === 2) {
                    base32_crockford._mode.split = 0;
                } else {
                    base32_crockford._mode.split = 2;
                }
            });
            input_cf.addEventListener('input', (e) => {
                cf_error.textContent = '';
                try {
                    let cf_input = BigInt(input_cf.value);
                    let ret_cf = base32_crockford.encode(cf_input);
                    let lasterror = base32_crockford.lasterror();
                    if (!lasterror.isError) {
                        cf_e.value = ret_cf;
                        cf_d.value = base32_crockford.decode(cf_e.value);
                        cf_d.value += ' (' + BigInt(cf_d.value) + ')';

                    } else {
                        cf_e.value = '';
                        cf_d.value = '';
                        cf_error.textContent = lasterror.message;//Invalid data: input number.
                    }

                } catch (error) {
                    cf_error.textContent = 'Invalid data: input number.'
                    cf_e.value = '';
                    cf_d.value = '';

                }
            });


        }, false);
    </script>
</body>

</html>